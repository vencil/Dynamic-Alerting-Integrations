# ============================================================
# Platform Recording Rules â€” å¯ç›´æ¥åˆä½µè‡³ Prometheus ConfigMap
# ============================================================
# æ”¶æ–‚ç‡: 7 æ¢è¦å‰‡ â†’ 8 æ¢ Recording Rules (å£“ç¸® 42.9%)
# ============================================================

groups:
  - name: custom_migrated-recording-rules
    rules:
      # ============================================================
      # ğŸš¨ğŸš¨ğŸš¨ [AI æ™ºèƒ½çŒœæ¸¬æ³¨æ„] ğŸš¨ğŸš¨ğŸš¨
      # ============================================================
      # ä»¥ä¸‹ recording rule çš„èšåˆæ¨¡å¼ç‚º AI è‡ªå‹•çŒœæ¸¬: max
      # çŒœæ¸¬åŸå› : é—œéµå­— 'queue' â€” å–®é»ä¸Šé™
      # åŸå§‹ Alert: RedisQueueTooLong
      #
      # âš ï¸  è«‹åœ¨è¤‡è£½è²¼ä¸Šå‰ç¢ºèª:
      #   - èšåˆæ¨¡å¼ max æ˜¯å¦æ­£ç¢º? (sum=å¢é›†ç¸½é‡, max=å–®é»ç“¶é ¸)
      #   - å¦‚ä¸ç¢ºå®šï¼Œè«‹ç”¨ --interactive æ¨¡å¼é‡æ–°åŸ·è¡Œ
      # ============================================================
      - record: tenant:custom_redis_queue_length:max
        expr: max by(tenant) (custom_redis_queue_length{tenant=~".+",queue="order-processing"})

      # ============================================================
      # ğŸš¨ğŸš¨ğŸš¨ [AI æ™ºèƒ½çŒœæ¸¬æ³¨æ„] ğŸš¨ğŸš¨ğŸš¨
      # ============================================================
      # ä»¥ä¸‹ recording rule çš„èšåˆæ¨¡å¼ç‚º AI è‡ªå‹•çŒœæ¸¬: max
      # çŒœæ¸¬åŸå› : é—œéµå­— 'queue' â€” å–®é»ä¸Šé™
      # åŸå§‹ Alert: RedisQueueTooLong
      #
      # âš ï¸  è«‹åœ¨è¤‡è£½è²¼ä¸Šå‰ç¢ºèª:
      #   - èšåˆæ¨¡å¼ max æ˜¯å¦æ­£ç¢º? (sum=å¢é›†ç¸½é‡, max=å–®é»ç“¶é ¸)
      #   - å¦‚ä¸ç¢ºå®šï¼Œè«‹ç”¨ --interactive æ¨¡å¼é‡æ–°åŸ·è¡Œ
      # ============================================================
      - record: tenant:alert_threshold:custom_redis_queue_length
        expr: max by(tenant) (user_threshold{metric="custom_redis_queue_length", severity="critical"})

      # ============================================================
      # ğŸš¨ğŸš¨ğŸš¨ [AI æ™ºèƒ½çŒœæ¸¬æ³¨æ„] ğŸš¨ğŸš¨ğŸš¨
      # ============================================================
      # ä»¥ä¸‹ recording rule çš„èšåˆæ¨¡å¼ç‚º AI è‡ªå‹•çŒœæ¸¬: sum
      # çŒœæ¸¬åŸå› : Counter å‘½åæ…£ä¾‹ (_total) â€” å¢é›†èšåˆç¸½é‡
      # åŸå§‹ Alert: ESIndexTooLarge
      #
      # âš ï¸  è«‹åœ¨è¤‡è£½è²¼ä¸Šå‰ç¢ºèª:
      #   - èšåˆæ¨¡å¼ sum æ˜¯å¦æ­£ç¢º? (sum=å¢é›†ç¸½é‡, max=å–®é»ç“¶é ¸)
      #   - å¦‚ä¸ç¢ºå®šï¼Œè«‹ç”¨ --interactive æ¨¡å¼é‡æ–°åŸ·è¡Œ
      # ============================================================
      - record: tenant:custom_elasticsearch_indices_store_size_bytes_total:sum
        expr: sum by(tenant) (custom_elasticsearch_indices_store_size_bytes_total{tenant=~".+",index="logs-prod"})

      # ============================================================
      # ğŸš¨ğŸš¨ğŸš¨ [AI æ™ºèƒ½çŒœæ¸¬æ³¨æ„] ğŸš¨ğŸš¨ğŸš¨
      # ============================================================
      # ä»¥ä¸‹ recording rule çš„èšåˆæ¨¡å¼ç‚º AI è‡ªå‹•çŒœæ¸¬: sum
      # çŒœæ¸¬åŸå› : Counter å‘½åæ…£ä¾‹ (_total) â€” å¢é›†èšåˆç¸½é‡
      # åŸå§‹ Alert: ESIndexTooLarge
      #
      # âš ï¸  è«‹åœ¨è¤‡è£½è²¼ä¸Šå‰ç¢ºèª:
      #   - èšåˆæ¨¡å¼ sum æ˜¯å¦æ­£ç¢º? (sum=å¢é›†ç¸½é‡, max=å–®é»ç“¶é ¸)
      #   - å¦‚ä¸ç¢ºå®šï¼Œè«‹ç”¨ --interactive æ¨¡å¼é‡æ–°åŸ·è¡Œ
      # ============================================================
      - record: tenant:alert_threshold:custom_elasticsearch_indices_store_size_bytes_total
        expr: max by(tenant) (user_threshold{metric="custom_elasticsearch_indices_store_size_bytes_total", severity="warning"})

      # ESIndexDocCountHigh | sum â€” Counter å‘½åæ…£ä¾‹ (_total) â€” å¢é›†èšåˆç¸½é‡
      - record: tenant:custom_elasticsearch_indices_docs_total:sum
        expr: sum by(tenant) (custom_elasticsearch_indices_docs_total{tenant=~".+",index="metrics", type="gauge"})

      # ESIndexDocCountHigh | sum â€” Counter å‘½åæ…£ä¾‹ (_total) â€” å¢é›†èšåˆç¸½é‡
      - record: tenant:alert_threshold:custom_elasticsearch_indices_docs_total
        expr: max by(tenant) (user_threshold{metric="custom_elasticsearch_indices_docs_total", severity="warning"})

      # MongoDBStorageTooLarge | sum â€” é—œéµå­— 'size' â€” å¢é›†ç´¯ç©é‡
      - record: tenant:custom_mongodb_dbstats_storage_size:sum
        expr: sum by(tenant) (custom_mongodb_dbstats_storage_size{tenant=~".+",database="orders"})

      # MongoDBStorageTooLarge | sum â€” é—œéµå­— 'size' â€” å¢é›†ç´¯ç©é‡
      - record: tenant:alert_threshold:custom_mongodb_dbstats_storage_size
        expr: max by(tenant) (user_threshold{metric="custom_mongodb_dbstats_storage_size", severity="warning"})

