============================================================
é·ç§»å ±å‘Š (Migration Report) â€” v4 (AST engine)
============================================================

ç¸½è¦å‰‡æ•¸: 8
  âœ… å®Œç¾è§£æ: 4
  âš ï¸  è¤‡é›œè¡¨é”å¼ (å·²è‡ªå‹•çŒœæ¸¬): 3
  ğŸš¨ ç„¡æ³•è§£æ (éœ€ LLM å”åŠ©): 1
  ğŸ“– å»ºè­°ä½¿ç”¨é»ƒé‡‘æ¨™æº–: 3

ğŸ“Š æ”¶æ–‚ç‡çµ±è¨ˆ:
  è¼¸å…¥: 8 æ¢å‚³çµ±è¦å‰‡
  è¼¸å‡º: 8 æ¢ Recording Rules + 4 æ¢ Alert Rules
  å£“ç¸®ç‡: 42.9%

----------------------------------------
ğŸ“– å»ºè­°ä½¿ç”¨é»ƒé‡‘æ¨™æº– â€” è«‹ç”¨ scaffold_tenant.py è¨­å®šé–¾å€¼
----------------------------------------
  â€¢ RedisHighMemory
    â†’ é»ƒé‡‘æ¨™æº–: RedisHighMemory
    â†’ Metric Key: redis_memory_used_bytes
    â†’ Rule Pack: redis
    â†’ Redis è¨˜æ†¶é«” â€” ç›´æ¥è¨­å®šé–¾å€¼
  â€¢ RedisHighKeyEvictions
    â†’ é»ƒé‡‘æ¨™æº–: RedisHighEviction
    â†’ Metric Key: redis_evicted_keys_total
    â†’ Rule Pack: redis
    â†’ Redis é©…é€ â€” rate() æŒ‡æ¨™
  â€¢ MongoDBHighConnections
    â†’ é»ƒé‡‘æ¨™æº–: MongoDBHighConnections
    â†’ Metric Key: mongodb_connections_current
    â†’ Rule Pack: mongodb
    â†’ MongoDB é€£ç·šæ•¸ â€” ç›´æ¥è¨­å®šé–¾å€¼

----------------------------------------
âœ… å®Œç¾è§£æçš„è¦å‰‡
----------------------------------------
  â€¢ ESIndexDocCountHigh: sum (Counter å‘½åæ…£ä¾‹ (_total) â€” å¢é›†èšåˆç¸½é‡)
  â€¢ MongoDBStorageTooLarge: sum (é—œéµå­— 'size' â€” å¢é›†ç´¯ç©é‡)

----------------------------------------
âš ï¸  è¤‡é›œè¡¨é”å¼ â€” å·²è‡ªå‹•çŒœæ¸¬èšåˆæ¨¡å¼ï¼Œå»ºè­°äººå·¥ç¢ºèª
----------------------------------------
  â€¢ RedisQueueTooLong: max (é—œéµå­— 'queue' â€” å–®é»ä¸Šé™)
    ğŸ“ ç¶­åº¦æ¨™ç±¤åµæ¸¬: [{'metric': 'redis_queue_length', 'labels': {'queue': 'order-processing'}}]
  â€¢ ESIndexTooLarge: sum (Counter å‘½åæ…£ä¾‹ (_total) â€” å¢é›†èšåˆç¸½é‡)
    ğŸ“ ç¶­åº¦æ¨™ç±¤åµæ¸¬: [{'metric': 'elasticsearch_indices_store_size_bytes_total', 'labels': {'index': 'logs-prod'}}]

----------------------------------------
ğŸš¨ ç„¡æ³•è‡ªå‹•è§£æ â€” è«‹å°‡ä»¥ä¸‹ LLM Prompt äº¤çµ¦ Claude è™•ç†
----------------------------------------

### MongoDBDown ###
è«‹å°‡ä»¥ä¸‹å‚³çµ± Prometheus Alert è½‰æ›ç‚ºæœ¬å°ˆæ¡ˆçš„å‹•æ…‹å¤šç§Ÿæˆ¶æ¶æ§‹ï¼š
è¦æ±‚ï¼š
1. æå–é–¾å€¼ä¸¦æä¾› threshold-config.yaml ç¯„ä¾‹ã€‚
2. æä¾›åŒ…å« sum/max by(tenant) çš„ Recording Ruleã€‚
3. æä¾›å¥—ç”¨ group_left èˆ‡ unless maintenance é‚è¼¯çš„ Alert Ruleã€‚
4. å¦‚æœ‰ç¶­åº¦æ¨™ç±¤ (å¦‚ queue, db, index)ï¼Œè«‹ç”¨ "metric{label=\"value\"}" èªæ³•æä¾›ç¯„ä¾‹ã€‚

åŸå§‹è¦å‰‡ï¼š
- alert: MongoDBDown
  expr: absent(mongodb_up) == 1
  for: 1m
  labels:
    severity: critical

