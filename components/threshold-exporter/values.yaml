# Default values for threshold-exporter
replicaCount: 2

image:
  repository: threshold-exporter
  tag: dev
  pullPolicy: Never    # Local dev: use 'kind load docker-image'

service:
  type: ClusterIP
  port: 8080
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
    prometheus.io/path: "/metrics"

# Exporter runtime config
exporter:
  listenAddr: ":8080"
  reloadInterval: "30s"    # How often to check config file for changes

# Threshold config (embedded in ConfigMap)
# This is the actual alerting threshold configuration.
# See config/conf.d/ directory for the reference multi-file format.
# For multi-DB examples (Redis, MongoDB, Elasticsearch), see:
#   config/conf.d/examples/ and migration-guide.md §7 (維度標籤)
thresholdConfig:
  defaults:
    # Scenario A: MySQL thresholds
    mysql_connections: 80
    mysql_cpu: 80
    # Scenario B: Container resource thresholds (% of limit)
    container_cpu: 80
    container_memory: 85

  # Scenario C: State-based monitoring filters
  # Each filter maps to kube_pod_container_status_waiting_reason values.
  # Enabled by default for all tenants; per-tenant disable via _state_<name>: "disable"
  state_filters:
    container_crashloop:
      reasons: ["CrashLoopBackOff"]
      severity: "critical"
    container_imagepull:
      reasons: ["ImagePullBackOff", "InvalidImageName"]
      severity: "warning"
    # Scenario D: Maintenance mode — unless 攔截所有常規警報
    # default_state: disable → 預設不啟用; 租戶透過 _state_maintenance: "enable" 開啟
    maintenance:
      reasons: []
      severity: "info"
      default_state: "disable"

  # Tenant overrides — 客戶依自身環境設定，chart 預設不帶任何測試租戶。
  # 透過 values-override.yaml 或 GitOps 注入，例如：
  #   tenants:
  #     db-a:
  #       mysql_connections: "70"
  #       container_cpu: "70"
  #     db-b:
  #       mysql_connections: "100"
  #       _state_container_crashloop: "disable"
  #
  # 開發/測試環境請使用 environments/local/threshold-exporter.yaml
  # 完整範例參見 config/conf.d/examples/
  tenants: {}

resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 200m
    memory: 128Mi

livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /ready
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
